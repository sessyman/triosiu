var paymentMethod=null;var serviceProvider=null;var signup=function(b,a){$(a.el).find("#signup-form").on("submit",function(h){h.preventDefault();var g=$(this);var f=g.find("[name=password]").val();var d=g.find("[name=cpass]").val();if(f!==d){merror("Passwords do not match.");return false}var c=mwait("Connecting...");$.post(getURL("register"),g.serialize(),function(e){if(e.r==="s"){c.close(true);malert("Successfully registered.");g.find("input[type=text],[type=password]").val("");getPage()}else{c.close(true);merror(e.text)}},"json").fail(function(e){c.close(true);merror(window.jsonError)})})};var login=function(b,a){$(a.el).find("#login-form").on("submit",function(h){h.preventDefault();var f=$(this);var d=f.find("[name=phone]");var g=f.find("[name=pass]");if(d.val()===""){merror("Please enter phone number");return}if(g.val()===""){merror("Please enter password");return}var c=mwait("Logging in...");$.post(getURL("login"),f.serialize(),function(l){if(l.r==="e"){c.close(true);merror(l.text)}else{setData(window.token,l.token);setData(window.username,l.username);setData(window.lname,l.lname);setData(window.fname,l.fname);setData(window.lad,l.lad);setData(window.groups,JSON.stringify(l.groups));setData(window.names,l.fname+" "+l.lname);setData(window.notesUnread,l.notifications.unread);var j=l.notifications;var m="";for(i=0;i<j.notes.length;i++){var k=j.notes[i];var n=k.message;if(!k.seen){n="<b>"+n+"</b>"}var e='<li class="list-item border bottom x-note-item" data-id='+k.code+" data-seen="+k.seen+">";e+='<a href="/joins/" class="media-hover p-15"><div class="media-img"><div class="icon-avatar bg-success"><i class="ti-user"></i></div></div>';e+='<div class="info"><span class="title">'+n+'</span><span class="sub-title">'+k.date+"</span></div></a></li>";m+=e}setData(window.notes,m);setData(window.notesCount,j.notes.length);c.close(true);app.router.navigate("/groups/")}},"json").fail(function(e){c.close(true);merror(window.jsonError)})})};var home=function(c,b){userNotifications();userSettings(b);var a=$(b.el);$.post(getURL("data"),currentUser(),function(d){if(d.r==="e"){merror(d.text)}else{$("#home-revenue").text("M"+numeral(d.data.cgroup.revenue).format("0,0.00"));$("#home-members").text(numeral(d.data.cgroup.members).format("0,0"));$("#home-requests").text(numeral(d.data.cgroup.requests).format("0,0"))}},"json").fail(function(){merror(window.jsonError)})};var userGroups=function(d){var a=null;var b=JSON.parse(getData(window.groups));for(i=0;i<b.length;i++){var e=b[i];var f='<li><a href="#" class="item-link item-content x-user-grup" data-code="'+e.code+'"><div class="item-media"><i class="fa fa-group"></i></div>';f+='<div class="item-inner"><div class="item-title"><div class="item-header">'+e.code+" | "+e.name+"</div>";f+='</div><div class="item-after">More</div></div></a></li>';$(f).insertBefore("#user-group-list .spacer")}var c=app.actions.create({buttons:[{text:"Load",bold:true,color:"color-blue",onClick:function(g){setData(window.currentGroup,JSON.stringify(findGroup(a)));app.router.navigate("/home/")}},{text:"Remove",color:"#f00"}]});$(d.detail.el).find(".x-user-grup").on("click",function(g){g.preventDefault();a=$(this).data("code");c.open()});if((getData(window.currentGroup)===undefined)||(getData(window.currentGroup)===null)){$(".navbar-inner .left a").remove()}userNotifications();userSettings(d.detail);$(d.detail.el).find("#join-group-form").on("submit",function(h){h.preventDefault();var g=$(this);g.find("input[name=phone]").val(getData(window.username));$.post(getURL("joingroup"),g.serialize(),function(j){if(j.r==="e"){if(j.text==="not_logged"){merror("Please login to continue");getPage("/login/")}else{merror(j.text)}}else{malert(j.text)}},"json").fail(function(j){merror(window.jsonError)})})};var joins=function(d){var c=null;var a=mwait();$.post(getURL("joingroup"),{phone:getData(window.username),action:"read"},function(g){if(g.r==="e"){a.close(true);merror(g.text)}else{var e="";for(i=0;i<g.requests.length;i++){var f=g.requests[i];var e='<li><a href="javascript:void(0);" class="item-link item-content x-request-btn" data-phone="'+f.member.phone+'" data-id='+f.id+'><div class="item-inner"><div class="item-title"><div class="item-header">'+f.date+"</div>| <label>"+f.msg+'</label></div><div class="item-after">More</div></div></a></li>'}$(e).insertBefore("#join-group .spacer");$("#join-group .x-request-btn").on("click",function(j){j.preventDefault();var h=$(this);c=h.data("id");joinsDialog(h.find("label").text(),c)});a.close(true)}},"json").fail(function(){merror(window.jsonError)});var b=app.actions.create({buttons:[{text:"Accept",bold:true,color:"color-blue",onClick:function(f){malert(c)}},{text:"Reject",color:"#f00"}]})};var joinsDialog=function(b,c){var a=app.dialog.create({text:b,buttons:[{text:"Cancel",cssClass:"button",onClick:function(){a.close()}},{text:"Reject",onClick:function(){mwait(null,false);$.post(getURL("joingroup"),{username:getData(window.username),phone:getData(window.username),token:getData(window.token),action:"reply",reply:"reject",note:c},function(d){if(d==="e"){merror(d.text)}else{malert(d.text)}},"json")}},{text:"Accept",onClick:function(){mwait(null,false);$.post(getURL("joingroup"),{username:getData(window.username),phone:getData(window.username),token:getData(window.token),action:"reply",reply:"accept",note:c},function(d){if(d==="e"){merror(d.text)}else{malert(d.text)}},"json")}}]});a.open()};var payments=function(e){userNotifications();userSettings(e.detail);var d=$(e.detail.el);if(d.is("#pay-type")){var f=e.detail.route.params.provider;d.find(".login-screen-title").html(f+" - type");d.find(".x-method-btn").on("click",function(j){j.preventDefault();var h=$(this);var g=h.data("method");app.router.navigate("/pay-amount/"+g+"/"+f+"/")})}else{if(d.is("#pay-amount")){var c=e.detail.route.params.payType;var f=e.detail.route.params.provider;d.find(".login-screen-title").html(c+" - amount");if(c!=="manual"){d.find("[name=reference]").attr("readonly","readonly").attr("disabled","disabled")}else{d.find("[name=reference]").removeAttr("readonly").removeAttr("disabled")}var b=("inapp"===c);d.find("[name=provider]").val(f);d.find("[name=method]").val(c);d.find("[name=username]").val(getData("username"));d.find("[name=token]").val(getData("token"));d.find("[name=mokhatlo]").val(JSON.parse(getData("cgroup")).code);var a=d.find("form");a.off("submit").on("submit",function(j){j.preventDefault();var g=a.find("[name=amount]").val();var h=a.find("[name=reference]").val();if(g==""||isNaN(g)){merror("Please enter a correct amount");return}if(!a.find("[name=reference]").is("[disabled]")){if(h.trim()===""){merror("Please enter correct reference");return}}$.post(getURL("payment"),a.serialize(),function(k){if(k.r==="e"){merror(k.text)}else{malert("Payment successfully made.");app.router.navigate("/home/")}},"json").fail(function(){merror(window.jsonError)})})}}};var provider=function(b){userNotifications();userSettings(b.detail);var a=$(b.detail.el);a.find(".x-tab-link").on("click",function(f){f.preventDefault();var d=$(this);var c=d.data("provider");app.router.navigate("/pay-type/"+c+"/")})};var notifications=function(b,a){$("#note-notes").html(getData(window.notes));userSettings(a)};